[build]
builder = "NIXPACKS"
buildCommand = "pnpm install --frozen-lockfile && pnpm run build"

[build.nixpacksPlan.phases.setup]
nixPkgs = ["nodejs", "pnpm", "python3"]

[deploy]
startCommand = "npx medusa db:migrate && pnpm run start"
healthcheckPath = "/health"
healthcheckTimeout = 120
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 3

[environments.development]
# Development-specific configurations
PORT = 9000
NODE_ENV = "production"
LOG_LEVEL = "debug"